{
    "collab_server" : "",
    "contents" : "# Get the main polygons, will determine by area.\ngetSmallPolys <- function(poly, minarea=0.01) {\n  # Get the areas\n  areas <- lapply(poly@polygons, \n                  function(x) sapply(x@Polygons, function(y) y@area))\n  \n  # Quick summary of the areas\n  print(quantile(unlist(areas)))\n  \n  # Which are the big polygons?\n  bigpolys <- lapply(areas, function(x) which(x > minarea))\n  length(unlist(bigpolys))\n  \n  # Get only the big polygons\n  for(i in 1:length(bigpolys)){\n    if(length(bigpolys[[i]]) >= 1 && bigpolys[[i]][4] >= 1){\n      poly@polygons[[i]]@Polygons <- poly@polygons[[i]]@Polygons[bigpolys[[i]]]\n      poly@polygons[[i]]@plotOrder <- 1:length(poly@polygons[[i]]@Polygons)\n    }\n  }\n  return(poly)\n}\n\nrequire(colorRamps)\n\nplotMw_Raster2 <- function(Population_Data, Map){\n  setwd('C:/Users/Peter/Documents/Earthquake_v4/Earthquake_v4/ALL_FUNCTIONS')\n  Olddir <- getwd()\n  Newdir <- paste(getwd(),'/FL_DISS_RASTER',sep = '')\n  Newdir2 <- paste(getwd(),'/PLOTS',sep='')\n  \n  Mw_Raster_file <- 'C:/Users/Peter/Documents/Earthquake_v4/Earthquake_v4/ALL_FUNCTIONS/FL_DISS_RASTER/COMBINED_FAULTS.csv'\n  Mw_Data <- read.csv(Mw_Raster_file, header = FALSE,skip = 6,sep=\" \")\n  Mw <- raster(Mw_Raster_file)\n  Mw33 <- asc.from.raster(Mw)\n  Mw.sp1 <- sp.from.asc(Mw33, projs = CRS(as.character(\"+init=epsg:4326\")))\n  #Mw.sp2 <- spTransform(Mw.sp1,CRS(as.character(\"+init=epsg:3857\")))\n  #Mw.sp1 <- Mw.sp2\n  plot(Mw.sp1)\n  \n  class(Mw.sp1)\n  Mw.sp2 <- Mw.sp1[Mw.sp1@data$z > 0,]\n  #rownames(Mw.sp3@data)\n  #rm(list= ls()[!(ls() %in% c('Mw.sp3','Map'))])\n  Mw.sp3 <- as(Mw.sp2, \"SpatialPolygonsDataFrame\")\n  # Mw.sp4 <- getSmallPolys(Mw.sp3,minarea = 0.1)\n  # Mw.sp5 <- gSimplify(Mw.sp3, tol=0.01, topologyPreserve=TRUE)\n  # length(Mw.sp5@polygons)\n  # Mw.sp3 <- Mw.sp5\n\n  setwd('C:/Users/Peter/Documents/Earthquake_v4/Earthquake_v4/ALL_FUNCTIONS/DATA/TUR_adm_shp/')\n  TUR <- readOGR(\".\", \"TUR_adm0\")\n  #TUR <- sp.from.asc(Mw33, projs = CRS(as.character(\"+init=epsg:4326\")))\n  TUR <- spTransform(TUR, CRSobj = CRS(proj4string(Mw.sp2)))\n  summary(TUR)\n  summary(Mw.sp2)\n  Mw.sp2 <- Mw.sp2[TUR,]\n  TRy50 <- data.frame(Mw.sp2)\n  \n  setwd('C:/Users/Peter/Documents/Earthquake_v4/Earthquake_v4/ALL_FUNCTIONS')\n  \n  Tur.f = data.frame(TUR)\n  \n  Tur.f <- tidy(TUR)\n  bTry50 <- TRy50\n  TRy50$z <- round(TRy50$z)\n  TRy50$z <- as.character(TRy50$z)\n  cols <- c(\"9\" = \"tomato4\", \"8\" = 'red4', \"7\" = \"orangered\",\"6\" = \"orange\",\"5\" = \"yellow\", \"4\" = \"yellow2\",\"3\" = \"green\")\n  graph2 <- ggplot(aes(x = s1, y = s2),data = TRy50) + geom_point(aes(color = z),size = 0.01) + scale_fill_manual(name = 'Mw', values = cols,breaks = c(4,5,6,7,8))\n  graph2 <- graph2 +  geom_path(aes(group = group, x = long, y = lat),data = Tur.f, color = 'red') + theme_void()\n\n  graph2\n  \n  pdf('Mw_Raster_Data.pdf')\n  print(graph2)\n  dev.off()\n  setwd(Olddir)\n  return(Mw.df)\n  \n  \n  \n  \n  \n  #MORE POWER NEEDED \n  \n\n  # #pdf('here.pdf')\n  # #plot(Mw.sp3)\n  # #dev.off()\n  # Mw.sp3@polygons[[1]]@Polygons[[1]]@coords\n  # Mw.sp3@data$id = rownames(Mw.sp3@data)\n  # Mw.sp3@data$id\n  # Mw.sp3.points = fortify(Mw.sp3, region=\"id\")\n  # save(Mw.sp3.points,file='FORTIFIED_Mw.R')\n  # load(file = 'FORTIFIED_Mw.R')\n  # Mw.df = join(Mw.sp3.points, Mw.sp3@data, by=\"id\")\n  # colnames(Mw.df) <- c('lon','lat','order','hole','piece','id','group','Mwulation')\n  # graph <- Map + geom_polygon(aes(group=group,fill=Mw.df),color = NA,data=Mw.df,alpha=0.3) + scale_color_gradient(low = \"light blue\", high = \"dark blue\")+scale_fill_gradient(low = \"light blue\", high = \"dark blue\")\n  # setwd(Newdir2)\n\n}\n",
    "created" : 1490168578784.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2533183428",
    "id" : "D5EDE203",
    "lastKnownWriteTime" : 1490170607,
    "last_content_update" : 1490170607216,
    "path" : "~/Earthquake_v4/Earthquake_v4/ALL_FUNCTIONS/02_13_Plot_Mw_Raster.R",
    "project_path" : "ALL_FUNCTIONS/02_13_Plot_Mw_Raster.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}